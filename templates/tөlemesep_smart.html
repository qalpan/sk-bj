<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Smart –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å 2025</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 20px; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .controls { display: flex; gap: 15px; margin-bottom: 25px; padding: 15px; background: #e9ecef; border-radius: 8px; align-items: center; flex-wrap: wrap; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #dee2e6; padding: 10px; text-align: center; font-size: 13px; }
        th { background: #2c3e50; color: white; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; color: white; }
        .btn-save { background: #27ae60; }
        .btn-load { background: #3498db; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>–¢“±—Ä“ì—ã–Ω “Æ–π “ö–∞—Ä–∂—ã—Å—ã: ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ</h2>
    
    <div class="controls">
        <button class="btn btn-load" onclick="fetchData()">–ë–∞–∑–∞–Ω—ã –∂–∞“£–∞—Ä—Ç—É</button>
        <select id="monthSelector" onchange="renderTable()">
            </select>
        <button class="btn btn-save" onclick="saveData()">”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Å–∞“õ—Ç–∞—É</button>
        <span id="syncStatus">–°—Ç–∞—Ç—É—Å: –î–∞–π—ã–Ω</span>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th>–ü”ô—Ç–µ—Ä ‚Ññ</th>
                <th>–®–∞—Ä—à—ã (–º¬≤)</th>
                <th>“ö—ã–∑–º–µ—Ç (Maint)</th>
                <th>–¢–∞–∑–∞–ª—ã“õ</th>
                <th>–ö“Ø–∑–µ—Ç</th>
                <th>–ñ—ã–ª—É</th>
                <th>–ö–∞–ø.–∂”©–Ω–¥–µ—É</th>
                <th><b>–ë–∞—Ä–ª—ã“ì—ã “ö–∞—Ä—ã–∑</b></th>
                <th>”ò—Ä–µ–∫–µ—Ç</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let db = { apartments: [] };
    const API_URL = '/api/data/';

    async function fetchData() {
        const res = await fetch(API_URL);
        db = await res.json();
        populateMonths();
        renderTable();
    }

    function populateMonths() {
        const selector = document.getElementById('monthSelector');
        const months = db.apartments[0].ledger.map(l => l.month);
        selector.innerHTML = months.map((m, i) => `<option value="${i}" ${i === months.length-1 ? 'selected' : ''}>${m}</option>`).join('');
    }

    function renderTable() {
        const monthIdx = document.getElementById('monthSelector').value;
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        db.apartments.forEach(apt => {
            const entry = apt.ledger[monthIdx];
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><b>${apt.id}</b></td>
                <td>${apt.area}</td>
                <td>${entry.charges.maint}</td>
                <td>${entry.charges.clean}</td>
                <td>${entry.charges.sec}</td>
                <td>${entry.charges.heat}</td>
                <td>${entry.charges.cap}</td>
                <td style="color:red"><b>${entry.accumulated.overall} ‚Ç∏</b></td>
                <td><button onclick="window.open('/pater/${apt.id}/')">üëÅÔ∏è</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function saveData() {
        await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(db)
        });
        alert("–°–∞“õ—Ç–∞–ª–¥—ã!");
    }

    window.onload = fetchData;
</script>
</body>
</html>
