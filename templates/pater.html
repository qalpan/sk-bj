<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Түбіртек: Пәтер {{ apt_id }}</title>
    <style>
        body { font-family: sans-serif; padding: 30px; background: #eee; }
        .receipt { background: white; max-width: 600px; margin: auto; padding: 20px; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .total { font-size: 20px; font-weight: bold; color: #2c3e50; background: #fff3cd; }
        .btn-pay { display: block; text-align: center; background: #27ae60; color: white; padding: 15px; text-decoration: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="receipt" id="app">
        <h2>Желтоқсан 2025 — Төлем түбіртегі</h2>
        <div id="content">Жүктелуде...</div>
    </div>

<script>
    async function loadPater() {
        const aptId = window.location.pathname.split('/')[2];
        const res = await fetch('/api/data/');
        const data = await res.json();
        const apt = data.apartments.find(a => a.id == aptId);
        const lastMonth = apt.ledger[apt.ledger.length - 1];

        document.getElementById('content').innerHTML = `
            <p>Пәтер: <b>${apt.id}</b> | Аудан: ${apt.area} м²</p>
            <p>Дербес шот: <b>${apt.account}</b></p>
            <table>
                <tr><th>Қызмет</th><th>Сомасы</th></tr>
                <tr><td>Үй күтімі</td><td>${lastMonth.charges.maint} ₸</td></tr>
                <tr><td>Тазалық</td><td>${lastMonth.charges.clean} ₸</td></tr>
                <tr><td>Күзет</td><td>${lastMonth.charges.sec} ₸</td></tr>
                <tr><td>Жылу</td><td>${lastMonth.charges.heat} ₸</td></tr>
                <tr><td>Күрделі жөндеу</td><td>${lastMonth.charges.cap} ₸</td></tr>
                <tr class="total"><td>Төлемге (Қарызбен):</td><td>${lastMonth.accumulated.overall} ₸</td></tr>
            </table>
            <a href="https://kaspi.kz/pay/${apt.account}" class="btn-pay">Kaspi-мен төлеу</a>
        `;
    }
    loadPater();
</script>
</body>
</html>
